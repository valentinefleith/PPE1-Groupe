<!DOCTYPE html>
<html lang="fr">
<head>
	<!--Métadonnées-->
	<meta charset="UTF-8"/>
	<title>Script - Tableaux</title>
    <meta name = "author" content = "valentinefleith, ashleyratier, lidanzhang"/>
    <meta name = "keywords" content = "Argent"/>
    <meta name = "description" content = "Projet groupe PPE1"/>

	<!--Bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="script_tableau.css">

    <!--Google Fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap" rel="stylesheet">
		<link href="codef/prism.css" rel="stylesheet">
</head>

<body>
    <div class="Bigcontainer">
        <!--Navbar-->
        <nav class="navbar navbar-expand-lg bg-body-tertiary" id="navbar">
            <div class="container-fluid">
                <a class="navbar-brand" href="../index.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-piggy-bank" viewBox="0 0 16 16">
                    <path d="M5 6.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.138-1.496A6.613 6.613 0 0 1 7.964 4.5c.666 0 1.303.097 1.893.273a.5.5 0 0 0 .286-.958A7.602 7.602 0 0 0 7.964 3.5c-.734 0-1.441.103-2.102.292a.5.5 0 1 0 .276.962"/>
                    <path fill-rule="evenodd" d="M7.964 1.527c-2.977 0-5.571 1.704-6.32 4.125h-.55A1 1 0 0 0 .11 6.824l.254 1.46a1.5 1.5 0 0 0 1.478 1.243h.263c.3.513.688.978 1.145 1.382l-.729 2.477a.5.5 0 0 0 .48.641h2a.5.5 0 0 0 .471-.332l.482-1.351c.635.173 1.31.267 2.011.267.707 0 1.388-.095 2.028-.272l.543 1.372a.5.5 0 0 0 .465.316h2a.5.5 0 0 0 .478-.645l-.761-2.506C13.81 9.895 14.5 8.559 14.5 7.069c0-.145-.007-.29-.02-.431.261-.11.508-.266.705-.444.315.306.815.306.815-.417 0 .223-.5.223-.461-.026a.95.95 0 0 0 .09-.255.7.7 0 0 0-.202-.645.58.58 0 0 0-.707-.098.735.735 0 0 0-.375.562c-.024.243.082.48.32.654a2.112 2.112 0 0 1-.259.153c-.534-2.664-3.284-4.595-6.442-4.595zM2.516 6.26c.455-2.066 2.667-3.733 5.448-3.733 3.146 0 5.536 2.114 5.536 4.542 0 1.254-.624 2.41-1.67 3.248a.5.5 0 0 0-.165.535l.66 2.175h-.985l-.59-1.487a.5.5 0 0 0-.629-.288c-.661.23-1.39.359-2.157.359a6.558 6.558 0 0 1-2.157-.359.5.5 0 0 0-.635.304l-.525 1.471h-.979l.633-2.15a.5.5 0 0 0-.17-.534 4.649 4.649 0 0 1-1.284-1.541.5.5 0 0 0-.446-.275h-.56a.5.5 0 0 1-.492-.414l-.254-1.46h.933a.5.5 0 0 0 .488-.393zm12.621-.857a.565.565 0 0 1-.098.21.704.704 0 0 1-.044-.025c-.146-.09-.157-.175-.152-.223a.236.236 0 0 1 .117-.173c.049-.027.08-.021.113.012a.202.202 0 0 1 .064.199z"/>
                    </svg>
                      Projet PPE1</a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="../index.html">Accueil</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="methode.html">Présentation du projet</a>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link active dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Scripts
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="script_tableau.html">Tableaux</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="script_concordancier.html">Concordanciers</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="script_itrameur.html">iTrameur</a></li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Tableaux
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="../tableaux/tableau_fr.html">Français</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../tableaux/tableau_en.html">Anglais</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="../tableaux/tableau_zh.html">Chinois</a></li>
                    </ul>
                  </li>
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Analyse
                    </a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="analyse_fr.html">Français</a></li>
                      <li><a class="dropdown-item" href="analyse_en.html">Anglais</a></li>
                      <li><a class="dropdown-item" href="analyse_zh.html">Chinois</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item" href="conclusion.html">Conclusion</a></li>
                    </ul>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="nuage.html">Nuages des mots</a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>    
<div class="myContainer">
    <!--Choix du mot-->
    <div class="scriptContainer">
        <p class="scriptTitleText">Script de creation des tableaux</p>

					<p class="script">Pour lancer le script, il faut donner en argument le chemin vers le fichier d'urls. Comme le fichier d'URLS contient la langue dans son nom, le script détecte automatiquement quelle langue nous sommes en train de traiter : cela nous a donc évité de devoir écrire 3 scripts différents pour chaque langue, nous avons seulement dû hardcoder le mot à l'intérieur du script. <br><br>
						Ensuite, le script crée un fichier html qui contient le tableau pour la langue donnée. Pour ce faire, il va imprimer le numéro de ligne, l'URL, le lien vers le fichier aspiration, le lien vers le fichier dump, le lien vers le fichier contexte, le lien vers le concordancier, le code de réponse HTTP, l'encodage et le compte du nombre de mots qui se trouvent dans la page.
						<br><br>
							Nous avons fait en sorte que lorsque le code de réponse HTTP n'est pas le code attendu (200), alors l'URL reste dans le tableau mais le traitement n'est pas effectué. Toute la ligne contient alors l'information "NA" pour indiquer que le traitement n'était pas faisable sur la page. Lorsque le script tourne sur notre terminal, nous avons choisi d'imprimer le mot "OK" sur la sortie standard afin que nous soyions informées de l'avancement du script pendant qu'il tournait, et que nous soyions sûres de ne pas être tombées dans une boucle infinie ou dans un problème au niveau d'un URL en particulier.
						<br><br>
							Comme pistes d'amélioration pour le script, nous aurions pu envisager peut-être de séparer davantage les responsabilités de ce programme-ci. En effet, nous avons remarqué qu'à chaque changement, par exemple au niveau du concordancier, l'intégralité du script était à relancer : les dumps, aspirations, contextes etc. étaient regénérés alors qu'ils étaient parfaitement corrects et qu'il n'y avait que le concordancier à refaire. En effet, bien que nous avions un script "concordancier" indépendant, ce dernier prenait en argument le numéro de la ligne et ne pouvait donc pas automatiquement refaire tous les concordanciers. Cela a drastiquement rallongé le temps de lancement du script principal, et le nombre de fois où nous avons dû le lancer.
					</p>
                Script de création des concordanciers
					<script src="codef/prism.js"></script>
					<pre>
	<code class="language-bash">
#!/usr/bin/env bash

if [[ $# -ne 1 ]]; then
	echo &quot;Usage : ./creation_tableaux.sh /chemin/vers/urls.txt&quot;
    exit
fi

URLS=$1

if [ ! -f &quot;$URLS&quot; ]; then
    echo &quot;On attend un fichier, pas un dossier.&quot;
    exit
fi

LANGUE=$(basename -s .txt $URLS)

if [ $LANGUE = &quot;fr&quot; ]; then
		MOT=&quot;argent&quot;
fi
 
if [ $LANGUE = &quot;en&quot; ]; then
		MOT=&quot;money&quot;
fi

if [ $LANGUE = &quot;zh&quot; ]; then
		MOT=&quot;钱&quot;
fi

OUTPUT_FILE=&quot;../tableaux/tableau_${LANGUE}.html&quot;

echo &quot;&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr&quot;&gt;
&lt;head&gt;
	&lt;!--Métadonnées--&gt;
	&lt;meta charset=&quot;UTF-8&quot;/&gt;
	&lt;title&gt;Tableaux- PPE1 Projet Groupe&lt;/title&gt;
    &lt;meta name = &quot;author&quot; content = &quot;valentinefleith, ashleyratier, lidanzhang&quot;/&gt;
    &lt;meta name = &quot;keywords&quot; content = &quot;Argent&quot;/&gt;
    &lt;meta name = &quot;description&quot; content = &quot;Projet Groupe PPE1&quot;/&gt;

	&lt;!--Bootstrap--&gt;
    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN&quot; crossorigin=&quot;anonymous&quot;&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;methode.css&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;table class=\&quot;table table-striped-columns\&quot;&gt;
		&lt;thead&gt;
		  &lt;tr&gt;
			&lt;th scope=&quot;col&quot;&gt;Nº ligne&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;URL&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Aspiration&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Dump&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Contexte&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Concordancier&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Code HTTP&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Encodage&lt;/th&gt;
			&lt;th scope=&quot;col&quot;&gt;Compte&lt;/th&gt;
		  &lt;/tr&gt;
		&lt;/thead&gt;&quot; &gt; $OUTPUT_FILE
lineno=1
while read -r URL; do
	FICHIER_ASPIRATION=&quot;../aspirations/${LANGUE}-${lineno}.html&quot;

    response=$(curl -s -L -w &quot;%{http_code}&quot; -o &quot;$FICHIER_ASPIRATION&quot; &quot;$URL&quot;)
    encoding=$(curl -s -I -L -w &quot;%{content_type}&quot; -o /dev/null &quot;$URL&quot; | egrep -o &quot;charset=\S+&quot; | cut -d&quot;=&quot; -f2 | tail -n 1 | tr &apos;[:lower]&apos; &apos;[:upper&quot;]&apos;)
	COMPTE=0
	FICHIER_DUMP=&quot;NA&quot;
	FICHIER_CONTEXTE=&quot;NA&quot;
	CONCORDANCIER=&quot;NA&quot;
if [ $response -eq 200 ];then
	#creation du dump text
	if [[ ! $encoding == &quot;UTF-8&quot; ]]
	then
		iconv -f &quot;$encoding&quot; -t &quot;UTF-8&quot; &quot;$FICHIER_ASPIRATION&quot; &gt; &quot;temp.html&quot;
		mv &quot;temp.html&quot; &quot;$FICHIER_ASPIRATION&quot;
		encoding=&quot;UTF-8&quot;
	fi
		FICHIER_DUMP=&quot;../dump-texts/${LANGUE}-${lineno}.txt&quot;
		lynx -assume_charset=&quot;UTF-8&quot; -dump -nolist &quot;$FICHIER_ASPIRATION&quot; &gt; &quot;$FICHIER_DUMP&quot;

		COMPTE=$(egrep -i -o &quot;$MOT&quot; $FICHIER_DUMP | wc -l)

		#CONTEXTE=$(egrep -i -C 3 &quot;$MOT&quot; $FICHIER_DUMP)
		FICHIER_CONTEXTE=&quot;../contextes/${LANGUE}-${lineno}.txt&quot;
		egrep -i -C 3 &quot;$MOT&quot; $FICHIER_DUMP &gt; $FICHIER_CONTEXTE

		./concordancier.sh $MOT $lineno $FICHIER_CONTEXTE $LANGUE
		CONCORDANCIER=&quot;../concordances/${LANGUE}-${lineno}.html&quot;
    echo &quot;&lt;tbody&gt;
		&lt;tr&gt;
				&lt;th&gt;$lineno&lt;/th&gt;&lt;td&gt;$URL&lt;/td&gt;&lt;td&gt;&lt;a href=&apos;$FICHIER_ASPIRATION&apos;&gt;Aspiration&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&apos;$FICHIER_DUMP&apos;&gt;Dump&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&apos;$FICHIER_CONTEXTE&apos;&gt;Contexte&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href=&apos;$CONCORDANCIER&apos;&gt;Concordancier&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$response&lt;/td&gt;&lt;td&gt;$encoding&lt;/td&gt;&lt;td&gt;$COMPTE&lt;/td&gt;
		&lt;/tr&gt;
		&lt;/tbody&gt;&quot; &gt;&gt; $OUTPUT_FILE

	else
		FICHIER_ASPIRATION=&quot;NA&quot;
		echo &quot;&lt;tbody&gt;
			&lt;tr&gt;
				&lt;th&gt;$lineno&lt;/th&gt;&lt;td&gt;$URL&lt;/td&gt;&lt;td&gt;$FICHIER_ASPIRATION&lt;/td&gt;&lt;td&gt;$FICHIER_DUMP&lt;/td&gt;&lt;td&gt;$FICHIER_CONTEXTE&lt;/td&gt;&lt;td&gt;$CONCORDANCIER&lt;/td&gt;&lt;td&gt;$response&lt;/td&gt;&lt;td&gt;$encoding&lt;/td&gt;&lt;td&gt;$COMPTE&lt;/td&gt;
			&lt;/tr&gt;
			&lt;/tbody&gt;&quot; &gt;&gt; $OUTPUT_FILE
fi
    lineno=$(expr $lineno + 1)
	echo &quot;OK&quot;
done &lt; &quot;$URLS&quot;
echo &quot;         &lt;/table&gt;
        &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot; &gt;&gt; $OUTPUT_FILE


</code>
					</pre>
            </div>
        </div>
    </div>

</div>  
</body>
